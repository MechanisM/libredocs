<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- icons are 'document', 'brain', 'ruler', 'sync', 'newspaper' and 'cheerleader' from http://thenounproject.com/ -->
    <!-- svg editor is http://code.google.com/p/svg-edit/ -->
    <!-- most of the other stuff from http://unhosted.org -->
    <meta charset="utf-8">
    <title>Libre Docs</title>
    <link rel="icon" type="image/svg" href="../images/document.svg"/>
    <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">
    <script src="beFree/pimp.js"></script>
    <script src="beFree/files/base64.js"></script>
    <script src="beFree/files/sha1.js"></script>
    <script src="http://unhosted.nodejitsu.com/require.js" data-main="http://unhosted.nodejitsu.com/main"></script>
    <script src="/remoteStorageClient.js"></script>
    <script>
      remoteStorageClient.on('status', function(status) {
        document.getElementById('header').innerHTML = 'LibreDocs'+(status.userAddress?' - '+status.userAddress:'')+(status.background?' ('+status.background+')':'');
        for(i in status.buttons) {
          document.getElementById('header').innerHTML += ' <input type="submit" value="'+status.buttons[i]+'" onclick="remoteStorageClient.'+status.buttons[i]+'();">';
        }
      });
      function showList() {
        var str = '';
        var docs = JSON.parse(localStorage.getItem('list'));
        if(localStorage.getItem('currDoc')) {
          var preview = localStorage.getItem('text'+localStorage.getItem('currDoc'));
          if(preview) {
            docs[localStorage.getItem('currDoc')].preview = preview.substring(0,80);
          } else {
            docs[localStorage.getItem('currDoc')].preview = '(empty)';
          }
          docs[localStorage.getItem('currDoc')].timestamp = new Date().getTime();
          localStorage.setItem('list', JSON.stringify(docs));
          localStorage.removeItem('currDoc');
        }
        for(i in docs) {
          str += '<tr onclick="showDoc('+i+');"><td><strong>'
            +docs[i].preview
            +'</td><td><em>'
            +docs[i].timestamp
            +'</em></td></tr>';
        }
        str += '<tr onclick="showDoc();"><td><strong>+(new)'
          +'</td><td><em>'
          +'</em></td></tr>';
        document.getElementById('list').innerHTML = str;
      }
      function showDoc(i) {
        if(!i) {
          i = new Date().getTime();
          var docs = JSON.parse(localStorage.getItem('list'));
          if(!docs) {
            docs = {};
          }
          docs[i] = {};
          docs[i].preview = '(new doc)';
          docs[i].timestamp = new Date().getTime();
          localStorage.setItem('list', JSON.stringify(docs));
        }
        var sessionObj = JSON.parse(localStorage.getItem('sessionObj'));
        sessionObj.currDocId = i;
        localStorage.setItem('sessionObj', JSON.stringify(sessionObj));
        window.location='/write/';
      }
    </script>
    <link rel="icon" type="image/svg" href="../images/document.svg" />
  </head>
  <body onload="showList();remoteStorageClient.checkForLogin();">
    <h2 id="header">Libre Docs</h2>
    <div id="3" style="display:none;">
      <h2>Please sign up for easy freedom</h2>
      <p>
        I, <input id="firstName" placeholder="first name"> <input id="lastName" placeholder="last name">, agree with the Terms of Service of IrisCouch.com. <input type="submit" value="Agree" onclick="remoteStorageClient.agree();">
      </p>
      <p>
        <a href="/beFree/advanced.html">or choose for advanced freedom</a>.</div>
      </p>
    </div>
    <table class="zebra-striped" id="list">
    </table>
  </body>
</html>
