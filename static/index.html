<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Libre Docs - Write, Draw, Sync, Publish, Be free</title>
    <script>
      function go() {
        document.getElementById("1").style.display='none';
        document.getElementById("2").style.display='block';
        navigator.id.get(function(assertion) {
          document.getElementById("2").innerHTML='<h2>Checking your user address...</h2>';
          var xhr=new XMLHttpRequest();
          xhr.open('POST', 'http://useraddress.net/browserid-get', true);
          xhr.onreadystatechange = function() {
            if(xhr.readyState == 4) {
              var storageObj = {};
              try {
                storageObj = JSON.parse(xhr.responseText);
              } catch(e) {
              }
              if(storageObj.ok) {
                localStorage.setItem('LibreDocsUserAddress', storageObj.userAddress);
                window.location='/loggedIn.html';
              } else {
                document.getElementById("2").style.display='none';
                document.getElementById("3").style.display='block';
              }
            }
          };
          xhr.send(JSON.stringify({
            audience: 'http://libredocs.org',
            assertion: assertion
          }));
        });
      }
      function agree() {
        localStorage.setItem('LibreDocsUserAddress', 'provisioning your storage, please wait... [this part is fake]');
        window.location='/loggedIn.html';
      }
    </script>
  </head>
  <body>
    <input type="submit" value="Start" id="1" onclick="go();" disabled="true" style="width:400px;height:200px;border-radius:20px;background-color:lightgreen;font-size:56px;">
    <div id="2" style="display:none;"><h2>Please wait...</h2></div>
    <div id="3" style="display:none;"><h2>Please sign up for easy freedom</h2>I, <input id="firstName" placeholder="first name"> <input id="lastName" placeholder="last name">, agree with the Terms of Service of IrisCouch.com. <input type="submit" value="Agree" onclick="agree();">
    <br>
    <br>
    <br>
    <a href="/beFree/advanced.html">or choose for advanced freedom</a>.</div>
  </body>
  <script src="http://browserid.org/include.js"></script>
  <script>
    document.getElementById("1").disabled=false;
  </script>
</html>
